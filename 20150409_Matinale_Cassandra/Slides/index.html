<!DOCTYPE html>
<html>
  <head>
    <title>Matinale Cassandra</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <style type="text/css">
      @import url(http://fonts.googleapis.com/css?family=Roboto:400,300,400italic,700);
      @import url(http://fonts.googleapis.com/css?family=Inconsolata);
      body { 
	font-family: 'Arial'; 
	font-size: 22pt;
      }
      /* Rouge Zenika: rgb (179, 12, 55) */
      h1, h2, h3 {
	font-family: 'Roboto' sans-serif;
	color: rgb(179, 12, 55);
      }
      .remark-slide-content {
	font-family: 'Arial' sans-serif; 
	font-size: 22pt;
	color: rgb(51,51,51);
	padding: 1em 2em;
      }
      .remark-slide-content h1 {
        font-weight: 300;
        font-size: 32pt;
      }
      .remark-slide-content h1:before {
	content: url(images/zenika-logo.png);
        padding-right: 1em;
      }
      .remark-slide-content h2 {
        font-weight: 400;
        font-size: 26pt;
      }
      .remark-slide-content li {
	margin-bottom: 0.2em;
	margin-top: 0.2em;
      }
      .remark-slide-content strong {
	color: rgb(179, 12, 55);
      }
      .remark-code, .remark-inline-code { 
	font-family: 'Inconsolata' monospace; 
        font-size: 16pt;
      }
            /* Two-column layout */
      .left-column {
        width: 45%;
        float: left;
      }
      .small-left-column {
        width: 33%;
        float: left;
      }
      .right-column {
        width: 45%;
        float: right;
      }

    </style>
  </head>
  <body>
    <textarea id="source">

class: center, middle

# Matinale Cassandra
## Sous titre?

---

# Agenda

1. Big Data 
2. NoSQL
3. Architecture de Cassandra 
4. Développer avec Cassandra


---

# Big Data

* Variété
* Vélocité
* Volume

---

# Big Data
 
* Haute-disponibilité
    - Réplication
    - Opérations à chaud &rarr; Distribution
    - Election du maître?
* Forts volumes
    - Distribution stockage &rarr; Partitionnement
* Performances
    - Distribution traitements &rarr; Réplication &amp; Load balancing
    - Chemin court vers la données
    - Colocalisation donnée &amp; traitement
    
---

# SQL or NoSQL?

> * Not using the relational model (nor the SQL language).
> * Open source.
> * Designed to run on large clusters
> * Based on the needs of 21st century web properties
> * No schema, allowing fields to be added to any record without controls
> 
> http://martinfowler.com/bliki/NosqlDefinition.html

---

# Modèles de données
.left-column[
Clé-Valeur

Relationnel

Document

Colonnes

Graphe

Mixte
]
.right-column[
![Data model](images/database-families.png)
]

???

# ACID ou BASE?

.left-column[
ACID
* Atomicity
* Coherence
* Isolation
* Durability
]

.right-column[
BASE
* Basically Available
* Soft state
* Eventual consistency
]

---

# Théorème de CAP

.left-column[
* Consistency
* Availability
* Partition tolerance
]
.right-column[
![CAP](images/cap-ca.png)
]

---

# CAP

.center[
![CAP](images/cap-database.png)
]

---

# Cassandra en résumé

* Scalabilité linéaire
* Tolérance aux pannes: masterless, 100% uptime
* Consistance réglable
* Multi-datacenter
* Simplicité opérationnelle
* Analytique

---

# Les origines

.center[
![CAP](images/dynamo-bigtable.png)
]

???

* 2008 Création par FaceBook
* 2010 V0.6 Apache 
* 2014 V2.1

---

# Plages de Tokens

.right[
![Token ranges](images/token-ranges.png)
]

---

# Hachage consistant

.right[
![Consistent Hashing](images/consistent-hashing.png)
]

---

# Réplication

.right[
![Replication](images/replication.png)
]

???

* Facteur de réplication (RF)
    - Par datacenter
    - Par keyspace
* Pourquoi?
    - Tolérance aux pannes
    - Distribution de la charge

---

# Scalabilité 

.right[
![Token range split](images/token-range-split.png)
]

---

# Scalabilité linéaire

.center[
![Scalabilité](images/netflix-scalability.png)
]
http://techblog.netflix.com/2011/11/benchmarking-cassandra-scalability-on.html

---

# Multi-datacenter

.left-column[
* Node&isin;Rack&isin;Datacenter
    - RF par Datacenter
    - Placement des réplicas
* Decoupage
    - Géographique
    - Logique
* Cloud
]
.right-column[
![Multi DataCenter](images/datacenters.png)
]

???

Réplicas
* RF par Datacenter
* Placement des réplicas

---

# Simplicité opérationnelle

* Packaging: .tar, .rpm, .deb, .exe
* Java, Python
* 1 seul processus
* 1 seul type de noeud
* Monitoring: nodetool, JMX, OpsCenter

---

# Consistance &amp; Coordinateur

.right[
![Write Consistency All](images/write-consistency-all.png)
]


---

# Niveau de consistance ALL/ONE

.right[
![Write Consistency One](images/write-consistency-one.png)
]

---

# Consistance réglable

* Niveau de consistance par requête
![Consistency gradient](images/consistency-gradient.png)  

.left-column[
* Consistance immédiate 
**R + W > RF**
![Immediate Consistency](images/consistency-immediate.png)  
]
.right-column[
* Consistance au final
![Eventual Consistency](images/consistency-eventual.png)  
]

---

# Résolution des conflits

* A l'écriture: timestamp sur les cellules
* A la lecture: *last write wins*

---

# Simplicité pour le développement

* Drivers Java, Python...
* CQL = SQL simplifié
* cqlsh
* DevCenter
* CCM, un cluster en local
* ORM: ObjectMapper, Achilles, Spring Data Cassandra

---

# CQL

```cql
CREATE TABLE utilisateur(
    id_utilisateur UUID,
    login VARCHAR,
    date_naissance TIMESTAMP,
    roles SET<VARCHAR>,
    PRIMARY KEY (id_utilisateur)
);

INSERT INTO utilisateur(id_utilisateur, login, 
    date_naissance, roles)
  VALUES ('abc123...', 'jdoe', 
    '1978-04-06',{'blogger','journaliste'});

SELECT * FROM utilisateur 
  WHERE id_utilisateur='abc123...';
```

---

# CQL Lignes de grande taille

```cql
CREATE TABLE message(
    id_utilisateur UUID,
    id_message TIMEUUID,
    message VARCHAR,
    PRIMARY KEY (id_utilisateur, id_message)
);

INSERT INTO message(id_utilisateur, id_message)
  VALUES ('abc123...', now(),'Vive Cassandra');

SELECT * FROM utilisateur 
  WHERE id_utilisateur='abc123...';
SELECT message FROM utilisateur 
  WHERE id_utilisateur='abc123...' AND id_message='cde456...';
```

---

# Modèle orienté colonne

* Table *utilisateur*
![Skinny Row](images/row-skinny.png)
* Table *message*
![Wide Row](images/row-wide.png)

* **Map**`<`RowKey, **SortedMap**`<`ColumnKey, ColumnValue`>>`

---

# Performance &amp; Modélisation

* Pour l'écriture
    - Append only + compaction
    - Pas de disk seek
* Pour la lecture
    - Règle d'or: Dénormaliser! 
	Besoin &rarr; Requête &rarr; Table
    - Caches par table

---

# Driver

* Java, Python, C#, C, Ruby, NodeJS
* Load balancing et tolérance aux pannes
* Synchrone ou asynchrone (réactive programming)


    </textarea>
    <script src="js/remark-latest.min.js">
    </script>
    <script>
      var slideshow = remark.create();
    </script>
  </body>
</html>